<template>
  <!-- SING UP ENTERPRISE: Vista de registro del usuario empresa-->
  <Visitor>
    <main class="flex flex-col justify-center py-8 sm:px-6 lg:px-8">
      <div class="sm:mx-auto">
        <h2
          class="mt-6 text-center text-3xl leading-9 font-extrabold text-gray-900"
        >Crear cuenta como Empresa</h2>
      </div>

      <div class="mt-6 sm:mx-auto sm:w-full sm:max-w-2xl">
        <nav>
          <ul class="bg-white shadow rounded-md divide-y divide-gray-300 md:flex md:divide-y-0">
            <li @click="step=0" class="group cursor-pointer relative md:flex-1 md:flex">
              <!-- Completed Step -->
              <div class="px-6 py-4 flex items-center text-sm leading-5 font-medium space-x-4">
                <div
                  class="flex-shrink-0 w-10 h-10 flex items-center justify-center border-2 rounded-full"
                  :class="step==0?'border-primary-600' : 'border-gray-300  group-hover:border-gray-400' "
                >
                  <p
                    :class="step==0?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                  >01</p>
                </div>
                <p
                  class="text-sm leading-5 font-medium"
                  :class="step==0?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                >Datos de la empresa</p>
              </div>

              <div class="hidden md:block absolute top-0 right-0 h-full w-5">
                <svg
                  class="h-full w-full text-gray-300"
                  viewBox="0 0 22 80"
                  fill="none"
                  preserveAspectRatio="none"
                >
                  <path
                    d="M0 -2L20 40L0 82"
                    vector-effect="non-scaling-stroke"
                    stroke="currentcolor"
                    stroke-linejoin="round"
                  />
                </svg>
              </div>
            </li>

            <li @click="step=1" class="group cursor-pointer relative md:flex-1 md:flex">
              <!-- Completed Step -->

              <div class="px-6 py-4 flex items-center text-sm leading-5 font-medium space-x-4">
                <div
                  class="flex-shrink-0 w-10 h-10 flex items-center justify-center border-2 rounded-full"
                  :class="step==1?'border-primary-600' : 'border-gray-300  group-hover:border-gray-400' "
                >
                  <p
                    :class="step==1?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                  >02</p>
                </div>
                <p
                  class="text-sm leading-5 font-medium"
                  :class="step==1?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                >Datos del administrador</p>
              </div>

              <div class="hidden md:block absolute top-0 right-0 h-full w-5">
                <svg
                  class="h-full w-full text-gray-300"
                  viewBox="0 0 22 80"
                  fill="none"
                  preserveAspectRatio="none"
                >
                  <path
                    d="M0 -2L20 40L0 82"
                    vector-effect="non-scaling-stroke"
                    stroke="currentcolor"
                    stroke-linejoin="round"
                  />
                </svg>
              </div>
            </li>

            <li @click="step=2" class="group cursor-pointer relative md:flex-1 md:flex">
              <!-- Completed Step -->

              <div class="px-6 py-4 flex items-center text-sm leading-5 font-medium space-x-4">
                <div
                  class="flex-shrink-0 w-10 h-10 flex items-center justify-center border-2 rounded-full"
                  :class="step==2?'border-primary-600' : 'border-gray-300  group-hover:border-gray-400' "
                >
                  <p
                    :class="step==2?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                  >03</p>
                </div>
                <p
                  class="text-sm leading-5 font-medium"
                  :class="step==2?'text-primary-600' : 'text-gray-500  group-hover:text-gray-900' "
                >Datos de la cuenta</p>
              </div>
            </li>
          </ul>
        </nav>

        <div class="mt-4 bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
          <div v-show="step==0">
            <div class="mt-4 grid grid-cols-1 row-gap-6 col-gap-4 sm:grid-cols-4">
              <!-- Sección de ingreso de DNI.
              Solicita el DNI y lo valida.-->
              <div class="sm:col-span-2">
                <label for="input_ruc" class="block text-sm font-medium leading-5 text-gray-700">RUC</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    placeholder="Ingrese su RUC"
                    id="input_ruc"
                    v-model="ruc"
                    @change="validateRUC"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                  <div
                    class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                  >
                    <IconSvg
                      v-show="!ruc_valid"
                      solid="solid"
                      icon="exclamation-circle"
                      myClass="h-5 w-5 text-red-500"
                    />
                    <IconSvg
                      v-show="ruc_valid"
                      solid="solid"
                      icon="check-circle"
                      myClass="h-5 w-5 text-green-500"
                    />
                  </div>
                </div>
                <small v-if="error_ruc" class="text-red-600">
                  {{
                  error_ruc
                  }}
                </small>
                <small v-if="vacio_ruc" class="text-yellow-600">
                  {{
                  vacio_ruc
                  }}
                </small>
              </div>

              <div class="sm:col-span-2">
                <label
                  for="input_name_enterprise"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Razón social</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    placeholder="Digite su razón social"
                    disabled="disabled"
                    id="input_name_enterprise"
                    type="text"
                    v-model="name_enterprise"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="vacio_name_enterprise" class="text-yellow-600">
                  {{
                  vacio_name_enterprise
                  }}
                </small>
              </div>
              <div class="sm:col-span-2">
                <label
                  for="input_cuenta_enterprise"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Cuenta bancaria</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    placeholder="Digite su Cuenta bancaria"
                    id="input_cuenta_enterprise"
                    type="text"
                    v-model="cuenta_enterprise"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="vacio_cuenta_enterprise" class="text-yellow-600">
                  {{
                  vacio_cuenta_enterprise
                  }}
                </small>
              </div>
              <div class="sm:col-span-2">
                <label
                  for="file_enterprise"
                  class="block text-sm leading-5 font-medium text-gray-700"
                >Imagen de la empresa</label>
                <div class="mt-2 flex items-center">
                  <div v-if="!file_enterprise">
                    <label
                      for="file_enterprise"
                      style="cursor: pointer"
                      class="py-2 px-3 border border-gray-300 rounded-md text-sm leading-4 font-medium text-center text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"
                    >Seleccionar imagen</label>

                    <span class="file_enterprise">
                      <input
                        id="file_enterprise"
                        type="file"
                        style="display:none;"
                        accept="image/png, .jpeg, .jpg"
                        @change="onFileChange($event, 'file_enterprise')"
                      />
                    </span>
                  </div>

                  <div class="flex items-center" style="width: 100%;" v-else>
                    <button
                      @click="removeImage($event, 'file_enterprise')"
                      class="py-2 px-3 border border-gray-300 rounded-md text-sm leading-4 font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"
                      style="width: 100%;"
                    >Eliminar imagen</button>

                    <div class="text-center" style="width: 100%;">
                      <img
                        :src="file_enterprise"
                        class="inline-block h-20 w-20 sm:h-32 sm:w-32 rounded-full"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-show="step==1">
            <div class="mt-4 grid grid-cols-1 row-gap-6 col-gap-4 sm:grid-cols-6">
              <!-- Sección de ingreso de DNI.
              Solicita el DNI y lo valida.-->
              <div class="sm:col-span-3">
                <label for="input_dni" class="block text-sm font-medium leading-5 text-gray-700">DNI</label>
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    placeholder="Ingrese su DNI"
                    id="input_dni"
                    v-model="dni"
                    @change="validateDNI"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                  <div
                    class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                  >
                    <IconSvg
                      v-show="!dni_valid"
                      solid="solid"
                      icon="exclamation-circle"
                      myClass="h-5 w-5 text-red-500"
                    />
                    <IconSvg
                      v-show="dni_valid"
                      solid="solid"
                      icon="check-circle"
                      myClass="h-5 w-5 text-green-500"
                    />
                  </div>
                </div>
                <small v-if="error_dni" class="text-red-600">
                  {{
                  error_dni
                  }}
                </small>
                <small v-if="vacio_dni" class="text-yellow-600">
                  {{
                  vacio_dni
                  }}
                </small>
              </div>

              <div class="sm:col-span-3">
                <label
                  for="photo"
                  class="block text-sm leading-5 font-medium text-gray-700"
                >Foto de Perfil</label>
                <div class="mt-2 flex items-center">
                  <div v-if="!file_admi">
                    <label
                      for="file_admi"
                      style="cursor: pointer"
                      class="py-2 px-3 border border-gray-300 rounded-md text-sm leading-4 font-medium text-center text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"
                    >Seleccionar imagen</label>

                    <span class="file_admi">
                      <input
                        id="file_admi"
                        type="file"
                        style="display:none;"
                        accept="image/png, .jpeg, .jpg"
                        @change="onFileChange($event,'file_admi')"
                      />
                    </span>
                  </div>

                  <div class="flex items-center" style="width: 100%;" v-else>
                    <button
                      @click="removeImage($event,'file_admi')"
                      class="py-2 px-3 border border-gray-300 rounded-md text-sm leading-4 font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"
                      style="width: 100%;"
                    >Eliminar imagen</button>

                    <div class="text-center" style="width: 100%;">
                      <img
                        :src="file_admi"
                        class="inline-block h-20 w-20 sm:h-32 sm:w-32 rounded-full"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <div class="sm:col-span-6">
                <label
                  for="input_name_admi"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Nombre(s)</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    placeholder="Ingrese sus nombres completos"
                    disabled="disabled"
                    id="input_name_admi"
                    v-model="name_admi"
                    type="text"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="vacio_name_admi" class="text-yellow-600">
                  {{
                  vacio_name_admi
                  }}
                </small>
              </div>
              <div class="sm:col-span-3">
                <label
                  for="input_lastnamep_admi"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Apellido Paterno</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    placeholder="Ingrese su apellido paterno"
                    disabled="disabled"
                    id="input_lastnamep_admi"
                    v-model="lastnamep_admi"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="vacio_lastnamep_admi" class="text-yellow-600">
                  {{
                  vacio_lastnamep_admi
                  }}
                </small>
              </div>

              <div class="sm:col-span-3">
                <label
                  for="input_lastnamem_admi"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Apellido Materno</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    placeholder="Ingrese su apellido materno"
                    disabled="disabled"
                    id="input_lastnamem_admi"
                    v-model="lastnamem_admi"
                    class="form-input block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="vacio_lastnamem_admi" class="text-yellow-600">
                  {{
                  vacio_lastnamem_admi
                  }}
                </small>
              </div>
            </div>
          </div>

          <div v-show="step==2">
            <div class="mt-4 grid grid-cols-1 row-gap-6 col-gap-4 sm:grid-cols-4">
              <div class="sm:col-span-2">
                <label
                  for="username"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Usuario</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    id="username"
                    v-model="username"
                    placeholder="Ingrese un nombre de usuario"
                    type="text"
                    required
                    class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="error_username" class="text-red-600">
                  {{
                  error_username
                  }}
                </small>
                <small v-if="vacio_username" class="text-yellow-600">
                  {{
                  vacio_username
                  }}
                </small>
              </div>
              <!-- Fin de sección de ingreso de usuario. -->

              <!-- Sección de ingreso de correo.
              Solicita un correo electrónico y lo valida.-->
              <div class="sm:col-span-2">
                <label for="email" class="block text-sm font-medium leading-5 text-gray-700">Correo</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    id="email"
                    v-model="email"
                    placeholder="Ingrese un correo electronico"
                    type="email"
                    required
                    class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="error_email" class="text-red-600">
                  {{
                  error_email
                  }}
                </small>
                <small v-if="vacio_email" class="text-yellow-600">
                  {{
                  vacio_email
                  }}
                </small>
              </div>
              <!-- Fin de sección de ingreso de correo. -->

              <!-- Sección de ingreso de contraseña.
              Solicita una contraseña y la valida.-->
              <div class="sm:col-span-2">
                <label
                  for="password"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Contraseña</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    id="password"
                    placeholder="Ingrese una contraseña"
                    v-model="password"
                    type="password"
                    required
                    class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-l-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="error_password" class="text-red-600">
                  {{
                  error_password
                  }}
                </small>
                <small v-if="vacio_pass" class="text-yellow-600">
                  {{
                  vacio_pass
                  }}
                </small>
              </div>
              <!-- Solicita repetir la contraseña y la valida. -->
              <div class="sm:col-span-2">
                <label
                  for="repeat_password"
                  class="block text-sm font-medium leading-5 text-gray-700"
                >Repetir Contraseña</label>
                <div class="mt-1 rounded-md shadow-sm">
                  <input
                    id="repeat_password"
                    v-model="repeat_password"
                    placeholder="Verifique su contraseña"
                    type="password"
                    required
                    class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-l-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm sm:leading-5"
                  />
                </div>
                <small v-if="error_repeat_password" class="text-red-600">
                  {{
                  error_repeat_password
                  }}
                </small>
                <small v-if="vacio_repeat_pass" class="text-yellow-600">
                  {{
                  vacio_repeat_pass
                  }}
                </small>
              </div>
            </div>
            <div class="mt-4 flex text-center justify-between">
              <div class="text-sm leading-5">
                <span
                  class="font-medium"
                >Al registrarte estás aceptando los términos y condiciones de uso del servicio SirwiyQuy.</span>
              </div>
            </div>
          </div>

          <div class="flex flex-row-reverse mt-6">
            <span class="ml-3 inline-flex rounded-md shadow-sm" v-show="step==2">
              <AnimatedButton
                content="Completar registro"
                color="primary"
                @onClick="submitSignup()"
                :isLoading="buttonLoading"
              ></AnimatedButton>
            </span>

            <button
              v-show="step<2"
              @click="step=step+1"
              class="ml-3 inline-flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-primary-600 hover:bg-primary-500 focus:outline-none focus:border-primary-700 focus:shadow-outline-primary active:bg-teal-700 transition duration-150 ease-in-out"
            >Siguiente</button>
            <button
              v-show="step>0"
              @click="step=step-1"
              type="button"
              class="py-2 px-4 border border-gray-300 rounded-md text-sm leading-5 font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:border-blue-300 focus:shadow-outline-blue active:bg-gray-50 active:text-gray-800 transition duration-150 ease-in-out"
            >Anterior</button>
          </div>

          <!-- Sección de logeo.
          Te redirige a la vista de logeo "Login".-->
          <div class="mt-4 flex text-right justify-between">
            <div class="text-base leading-5">
              <span class="font-medium">¿Ya tienes cuenta?</span>
              <router-link
                to="/login/enterprise"
                class="font-medium text-primary-600 hover:text-primary-500 focus:outline-none focus:underline transition ease-in-out duration-150"
              >¡Inicia sesión!</router-link>
            </div>
          </div>
          <!-- Fin de sección de logeo. -->
        </div>
      </div>
    </main>
  </Visitor>
</template>

<script>
import api from "../../api";

import Visitor from "../Layouts/Visitor";
import AnimatedButton from "../../components/AnimatedButton.vue";
import IconSvg from "../../components/IconSvg.vue";

export default {
  name: "SignUpEnterprise",
  components: {
    Visitor,
    AnimatedButton,
    IconSvg,
  },
  data: () => {
    return {
      hasError: false,
      buttonLoading: false,
      dni_valid: false,
      ruc_valid: false,
      isType: '',

      identifier: "empresa",

      step: 0,

      //Datos comunes de registro
      username: "",
      email: "",
      password: "",
      repeat_password: "",

      //Nombre de los campos de empresa
      name_enterprise: "",//Razon social de la empresa
      ruc: "",
      file_enterprise: "", //Imagen de la empresa
      cuenta_enterprise: "", //Cuenta bancaria de la empresa
      
      //Nombre de los campos del admi de la empresa
      file_admi: "", //Imagen del administrador de la sesion que registra a la empresa
      name_admi: "",
      lastnamep_admi: "",
      lastnamem_admi: "",
      dni: "",
     
      error_username: "",
      error_email: "",
      error_password: "",
      error_repeat_password: "",
     
      error_dni: "",
      error_ruc: "",
    
      vacio_username: "",
      vacio_email: "",
      vacio_pass: "",
      vacio_repeat_pass: "",
      vacio_name_enterprise: "",
      vacio_ruc: "",
      vacio_cuenta_enterprise: "", //Cuenta bancaria de la empresa
      vacio_name_admi: "",
      vacio_lastnamep_admi: "",
      vacio_lastnamem_admi: "",
      vacio_dni: "",
    };
  },
  methods: {
    //Validacion del DNI con la API
    async validateDNI() {
      //Se comprueba longitud del campo apenas se llene
      if ((this.dni.length >= 0 && this.dni.length < 8) || (this.dni.length > 8)) {
        this.hasError = true;
        this.error_dni = "El DNI debe tener 8 dígitos";
        this.vacio_dni = "";
        return;
      }else{
        this.hasError = false;
        this.error_dni = "";
        this.vacio_dni = "";
        this.isType = 'DNI';
      } 

      let response = await api.get(`/validate/${this.isType}/${this.dni}`)//Se envia validacion
      
      if (!response.ok) {
        this.dni_valid = false

        this.name_admi = "";
        this.lastnamep_admi = "";
        this.lastnamem_admi = "";
           
        return this.$toast.open({
          message: "El sistema detectó que el DNI no es válido",
          type: "error",
          duration: 8000,
          dismissible: true
        });   
      }
      
      //Si todo esta correcto obtengo datos del DNI, solo los más relevantes
      this.name_admi = response.data.data[0].nombres;
      this.lastnamep_admi = response.data.data[0].apellidoPaterno;
      this.lastnamem_admi = response.data.data[0].apellidoMaterno;
      this.dni_valid = true

      this.$toast.open({
        message: response.data.data.success,
        type: "success",
        duration: 8000,
        dismissible: true
      });
    },
    //Validacion del numero de RUC con la API
    async validateRUC() {
      //Se comprueba longitud del campo apenas se llene
      if ((this.ruc.length >= 0 && this.ruc.length < 11) || (this.ruc.length > 11)) {
        this.hasError = true;
        this.error_ruc = "El RUC debe tener 11 dígitos";
        this.vacio_ruc = "";
        return;
      }else{
        this.hasError = false;
        this.error_ruc = "";
        this.vacio_ruc = "";
        this.isType = 'RUC';
      } 

      let response = await api.get(`/validate/${this.isType}/${this.ruc}`)//Se envia validacion
      
      //Si recibo algún error del RUC
      if (!response.ok) {
        this.ruc_valid = false;

        this.name_enterprise = "";

        return this.$toast.open({
          message:"El sistema detecto que el RUC no es válido",
          type: "error",
          duration: 8000,
          dismissible: true,
        });
      }

      this.ruc_valid = true;
      this.name_enterprise = response.data.data[0].razonSocial;

      this.$toast.open({
        message: response.data.data.success,
        type: "success",
        duration: 8000,
        dismissible: true,
      });
    },

    //Funcion una vez llenado el formulario
    async submitSignup() {
      this.validateSubmit();
      if (this.hasError) return;
      this.buttonLoading = true;

      //Se condiciona la imagen de la empresa
       if(this.file_enterprise === '' | this.file_enterprise === "" | this.file_enterprise === null){
        this.buttonLoading = false;

        return this.$toast.open({
          message: 'Imagen de la empresa requerida',
          type: "error",
          duration: 8000,
          dismissible: true
        });
      }

      //Se condiciona las imagen del administrador
      if(this.file_admi === '' | this.file_admi === "" | this.file_admi === null){
        this.buttonLoading = false;
        
        return this.$toast.open({
          message: '¡La imagen es esencial según nuestras politicas! Por favor, ingrese una ...',
          type: "error",
          duration: 8000,
          dismissible: true
        });
      }

      //Se conecta con la lógica de negocio
      //RUC de  ejemplos en : http://www.sunat.gob.pe/descarga/BueCont/BueCont0.html
    /*  let response = await api.post(`/signup`, {
        identity: this.identifier,
        username: this.username,
        email: this.email,
        password: this.password,
        name_enterprise: this.name_enterprise,
        RUC: this.ruc,
        file_enterprise: this.file_enterprise,
        cuenta_enterprise: this.cuenta_enterprise, 
        file_admi: this.file_admi,
        name_admi: this.name_admi,
        lastnamep_admi: this.lastnamep_admi,
        lastnamem_admi: this.lastnamem_admi,
        DNI: this.dni,
      });

      //Si hay algun error en la creacion del usuario
      if (!response.ok) {
        this.buttonLoading = false;

        let er = response.error.errors;
        let mensaje = "Error desconocido";

        if (er.hasOwnProperty("username")) {
          mensaje = er.username[0];
        } else if (er.hasOwnProperty("email")) {
          mensaje = er.email[0];
        }

        return this.$toast.open({
          message: mensaje,
          type: "error",
          duration: 8000,
          dismissible: true,
        });
      }

      this.$toast.open({
        message: response.data.data.success1[0],
        type: "success",
        duration: 10000,
        dismissible : true,
      });

      //Si se envia correo con exito
      this.$toast.open({
        message: response.data.data.success2.original.success[0],
        type: "info",
        duration: 10000,
        dismissible: true,
      });

      //Redireccionamiento de rutas
      this.$router.push("/login/enterprise");*/
    },
    validateSubmit() {
      if(this.hasError == true) this.hasError = true;
        else this.hasError = false;
      //Validaciones del campo usuario
      if (this.username == "") {
        this.hasError = true;
        this.vacio_username = "Campo necesario";
        this.error_username = "";
      } else if (this.username.includes("@") || this.username.includes(".")) {
        this.hasError = true;
        this.vacio_username = "";
        this.error_username =
          "Usuario no válido, el usuario no debe de incluir @ o .";
      } else {
        this.error_username = "";
        this.vacio_username = "";
      }

      //Validaciones del campo Email
      if (this.email == "") {
        this.hasError = true;
        this.vacio_email = "Campo necesario";
        this.error_email = "";
      } else if (
        !this.email.includes("@") ||
        !this.email.includes(".") ||
        this.email.length < 5
      ) {
        this.hasError = true;
        this.vacio_email = "";
        this.error_email = "Correo no válido";
      } else {
        this.error_email = "";
        this.vacio_email = "";
      }

      //Validaciones del campo password
      if (this.password == "") {
        this.hasError = true;
        this.vacio_pass = "Campo necesario";
        this.error_password = "";
      } else if (this.password.length <= 5) {
        this.hasError = true;
        this.vacio_pass = "";
        this.error_password = "La contraseña debe ser mayor de 5 caracteres";
      } else {
        this.error_password = "";
        this.vacio_pass = "";
      }

      //Validaciones del campo repeat password
      if (this.repeat_password == "") {
        this.hasError = true;
        this.vacio_repeat_pass = "Campo necesario";
        this.error_repeat_password = "";
      } else if (this.repeat_password != this.password) {
        this.hasError = true;
        this.error_repeat_password = "Las contraseñas no coinciden";
        this.vacio_repeat_pass = "";
      } else {
        this.error_repeat_password = "";
        this.vacio_repeat_pass = "";
      }

      //Validacion del DNI
      if(this.dni.length==0){
        this.hasError = true;
        this.error_dni = "";
        this.vacio_dni = "Campo necesario";
      }else{
        this.error_dni = "";
        this.vacio_dni = "";
      } 
       
      //Comprobacion de nombres
      if (this.name_admi == "") {
        this.hasError = true;
        this.vacio_name_admi = "Campo necesario";
      } else this.vacio_name_admi = "";

      //Comprobacion de apellido paterno
      if (this.lastnamep_admi == "") {
        this.hasError = true;
        this.vacio_lastnamep_admi = "Campo necesario";
      } else this.vacio_lastnamep_admi = "";

      //Comprobacion de apellido materno
      if (this.lastnamem_admi == "") {
        this.hasError = true;
        this.vacio_lastnamem_admi = "Campo necesario";
      } else this.vacio_lastnamem_admi = "";
     
      //Comprobacion de razon social
      if (this.name_enterprise == "") {
        this.hasError = true;
        this.vacio_name_enterprise = "Campo necesario";
      } else this.vacio_name_enterprise = "";
    
      //Comprobacion de cuenta de empresa
      if (this.cuenta_enterprise == "") {
        this.hasError = true;
        this.vacio_cuenta_enterprise = "Campo necesario";
      } else this.vacio_cuenta_enterprise = "";

      //Comprobacion de RUC
      if(this.ruc.length==0){
        this.hasError = true;
        this.error_ruc = "";
        this.vacio_ruc = "Campo necesario";
      }else{
        this.error_ruc = "";
        this.vacio_ruc = "";
      } 
    },
    onFileChange(e, name) {
      var files = e.target.files || e.dataTransfer.files;
      this[name] = files;
      if (!files.length) return;
      this.createImage(files[0], name);
    },
    createImage(file, name) {
      var image = new Image();
      var reader = new FileReader();
      var vm = this;

      reader.onload = (e) => {
        vm[name] = e.target.result;
      };
      reader.readAsDataURL(file);
    },
    removeImage(e, name) {
      this[name] = "";
    },
  },
};
</script>